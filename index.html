<!DOCTYPE html>
<html>
<head>
    <title>Анализатор числовых данных</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        .slider-container {
            margin: 15px 0;
            display: flex;
            align-items: center;
        }
        .slider-container label {
            width: 120px;
            display: inline-block;
        }
        #graph {
            width: 100%;
            height: 600px;
        }
        .value-display {
            width: 50px;
            display: inline-block;
            text-align: center;
        }
        .stats {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<h1>Анализатор числовых данных</h1>
<p>Используйте ползунки, чтобы изменить количество наблюдений для каждого значения (1-5):</p>

<div class="slider-container">
    <label for="value1">Значение 1:</label>
    <input type="range" id="value1" min="0" max="50" value="10" class="slider">
    <span id="value1-value" class="value-display">10</span>
</div>

<div class="slider-container">
    <label for="value2">Значение 2:</label>
    <input type="range" id="value2" min="0" max="50" value="15" class="slider">
    <span id="value2-value" class="value-display">15</span>
</div>

<div class="slider-container">
    <label for="value3">Значение 3:</label>
    <input type="range" id="value3" min="0" max="50" value="20" class="slider">
    <span id="value3-value" class="value-display">20</span>
</div>

<div class="slider-container">
    <label for="value4">Значение 4:</label>
    <input type="range" id="value4" min="0" max="50" value="12" class="slider">
    <span id="value4-value" class="value-display">12</span>
</div>

<div class="slider-container">
    <label for="value5">Значение 5:</label>
    <input type="range" id="value5" min="0" max="50" value="8" class="slider">
    <span id="value5-value" class="value-display">8</span>
</div>

<div id="graph"></div>

<div class="stats" id="stats">
    <h3>Статистика распределения:</h3>
    <p>Среднее: <span id="mean-value">0</span></p>
    <p>Медиана: <span id="median-value">0</span></p>
    <p>Мода: <span id="mode-value">0</span></p>
    <p>Общее количество: <span id="total-value">0</span></p>
</div>

<script>
    // Элементы DOM
    const sliders = {
        value1: document.getElementById('value1'),
        value2: document.getElementById('value2'),
        value3: document.getElementById('value3'),
        value4: document.getElementById('value4'),
        value5: document.getElementById('value5')
    };

    // Начальные данные
    let observationData = {
        value1: 10,
        value2: 15,
        value3: 20,
        value4: 12,
        value5: 8
    };

    const values = [1, 2, 3, 4, 5];
    const colors = ['#e74c3c', '#f39c12', '#f1c40f', '#3498db', '#9b59b6'];

    // Рассчитываем статистики
    function calculateStats() {
        // Создаем массив всех наблюдений
        let allObservations = [];
        Object.keys(observationData).forEach((key, index) => {
            const value = values[index];
            const count = observationData[key];
            for (let i = 0; i < count; i++) {
                allObservations.push(value);
            }
        });

        if (allObservations.length === 0) {
            return {
                mean: 0,
                median: 0,
                mode: "нет данных",
                total: 0
            };
        }

        // Среднее
        const mean = allObservations.reduce((a, b) => a + b, 0) / allObservations.length;

        // Медиана
        const sorted = [...allObservations].sort((a, b) => a - b);
        const mid = Math.floor(sorted.length / 2);
        const median = sorted.length % 2 !== 0 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;

        // Мода
        const frequency = {};
        let maxFreq = 0;
        let modes = [];

        allObservations.forEach(value => {
            frequency[value] = (frequency[value] || 0) + 1;
            if (frequency[value] > maxFreq) {
                maxFreq = frequency[value];
                modes = [value];
            } else if (frequency[value] === maxFreq) {
                modes.push(value);
            }
        });

        const mode = [...new Set(modes)].join(', ');

        return {
            mean,
            median,
            mode,
            total: allObservations.length
        };
    }

    // Создаем график
    function createPlot() {
        const stats = calculateStats();
        const counts = Object.values(observationData);

        // Гистограмма
        const barChart = {
            x: values,
            y: counts,
            type: 'bar',
            name: 'Количество',
            marker: {
                color: colors
            }
        };

        // Кривая плотности (KDE)
        const allObservations = [];
        Object.keys(observationData).forEach((key, index) => {
            const value = values[index];
            const count = observationData[key];
            for (let i = 0; i < count; i++) {
                allObservations.push(value);
            }
        });

        let xKDE = [], yKDE = [];
        if (allObservations.length > 1) {
            const mean = stats.mean;
            const stdDev = Math.sqrt(allObservations.reduce((sq, n) => sq + Math.pow(n - mean, 2), 0) / allObservations.length);

            if (stdDev > 0) {
                const minVal = Math.min(...allObservations);
                const maxVal = Math.max(...allObservations);
                const range = maxVal - minVal;

                for (let x = minVal - 1; x <= maxVal + 1; x += 0.05) {
                    xKDE.push(x);
                    yKDE.push(
                        allObservations.length * 0.2 * Math.exp(-Math.pow(x - mean, 2) / (2 * Math.pow(stdDev, 2))) /
                        (stdDev * Math.sqrt(2 * Math.PI))
                    );
                }
            }
        }

        const kdeTrace = {
            x: xKDE,
            y: yKDE,
            type: 'scatter',
            mode: 'lines',
            name: 'Плотность',
            line: {
                color: '#2c3e50',
                width: 2
            },
            yaxis: 'y2'
        };

        // Линии статистик
        const meanLine = {
            x: [0.5, 5.5],
            y: [stats.mean, stats.mean],
            mode: 'lines',
            name: 'Среднее',
            line: {
                color: '#27ae60',
                width: 2,
                dash: 'dash'
            }
        };

        const medianLine = {
            x: [0.5, 5.5],
            y: [stats.median, stats.median],
            mode: 'lines',
            name: 'Медиана',
            line: {
                color: '#9b59b6',
                width: 2,
                dash: 'dot'
            }
        };

        const modeLines = stats.mode.split(', ').map(modeValue => ({
            x: [0.5, 5.5],
            y: [parseFloat(modeValue), parseFloat(modeValue)],
            mode: 'lines',
            name: 'Мода',
            line: {
                color: '#e67e22',
                width: 2,
                dash: 'dashdot'
            },
            showlegend: false
        }));

        const data = [barChart, kdeTrace, meanLine, medianLine, ...modeLines];

        const layout = {
            title: 'Распределение значений (1-5)',
            xaxis: {
                title: 'Значение',
                tickvals: values
            },
            yaxis: {
                title: 'Количество наблюдений',
                range: [0, Math.max(...counts) * 1.2]
            },
            yaxis2: {
                title: 'Плотность',
                overlaying: 'y',
                side: 'right',
                showgrid: false
            },
            legend: { x: 1.1 }
        };

        Plotly.newPlot('graph', data, layout);

        // Обновляем статистику
        updateStatsDisplay();
    }

    // Обновляем отображение статистики
    function updateStatsDisplay() {
        const stats = calculateStats();
        document.getElementById('mean-value').textContent = stats.mean.toFixed(2);
        document.getElementById('median-value').textContent = stats.median.toFixed(2);
        document.getElementById('mode-value').textContent = stats.mode;
        document.getElementById('total-value').textContent = stats.total;
    }

    // Обновляем график
    function updatePlot() {
        const counts = Object.values(observationData);
        const stats = calculateStats();

        // Обновляем гистограмму
        Plotly.restyle('graph', 'y', [counts], [0]);

        // Обновляем кривую плотности
        const allObservations = [];
        Object.keys(observationData).forEach((key, index) => {
            const value = values[index];
            const count = observationData[key];
            for (let i = 0; i < count; i++) {
                allObservations.push(value);
            }
        });

        let xKDE = [], yKDE = [];
        if (allObservations.length > 1) {
            const mean = stats.mean;
            const stdDev = Math.sqrt(allObservations.reduce((sq, n) => sq + Math.pow(n - mean, 2), 0) / allObservations.length);

            if (stdDev > 0) {
                const minVal = Math.min(...allObservations);
                const maxVal = Math.max(...allObservations);
                const range = maxVal - minVal;

                for (let x = minVal - 1; x <= maxVal + 1; x += 0.05) {
                    xKDE.push(x);
                    yKDE.push(
                        allObservations.length * 0.2 * Math.exp(-Math.pow(x - mean, 2) / (2 * Math.pow(stdDev, 2))) /
                        (stdDev * Math.sqrt(2 * Math.PI))
                    );
                }
            }
        }

        Plotly.restyle('graph', {
            x: [xKDE],
            y: [yKDE]
        }, [1]);

        // Обновляем линии статистик
        Plotly.restyle('graph', {
            y: [[stats.mean, stats.mean]]
        }, [2]);

        Plotly.restyle('graph', {
            y: [[stats.median, stats.median]]
        }, [3]);

        const modeValues = stats.mode.split(', ').filter(v => v !== "нет данных").map(parseFloat);
        const modeUpdates = modeValues.map((val, i) => ({
            y: [[val, val]]
        }));

        modeUpdates.forEach((update, i) => {
            Plotly.restyle('graph', update, [4 + i]);
        });

        // Обновляем отображение статистики
        updateStatsDisplay();

        // Обновляем масштаб оси Y
        Plotly.relayout('graph', {
            'yaxis.range': [0, Math.max(...counts) * 1.2]
        });
    }

    // Обработчики событий для ползунков
    Object.keys(sliders).forEach(key => {
        sliders[key].addEventListener('input', function() {
            observationData[key] = parseInt(this.value);
            document.getElementById(`${key}-value`).textContent = this.value;
            updatePlot();
        });
    });

    // Инициализация
    createPlot();
</script>
</body>
</html>